<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Python</title>
<!-- 2015-11-17 Tue 21:36 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Howard Hou" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://lianhonghou.github.io/css/norang.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Native Data Types</a>
<ul>
<li><a href="#sec-1-1">1.1. Identifiers and Keywords</a></li>
<li><a href="#sec-1-2">1.2. Boolean</a></li>
<li><a href="#sec-1-3">1.3. Numbers</a></li>
<li><a href="#sec-1-4">1.4. Lists</a></li>
<li><a href="#sec-1-5">1.5. Tuples</a></li>
<li><a href="#sec-1-6">1.6. Sets</a>
<ul>
<li><a href="#sec-1-6-1">1.6.1. set</a></li>
<li><a href="#sec-1-6-2">1.6.2. frozenset</a></li>
</ul>
</li>
<li><a href="#sec-1-7">1.7. Dictionaries</a></li>
<li><a href="#sec-1-8">1.8. None</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Strings</a></li>
<li><a href="#sec-3">3. regular expressions</a>
<ul>
<li><a href="#sec-3-1">3.1. Regular Expression</a></li>
<li><a href="#sec-3-2">3.2. Module Contents</a></li>
<li><a href="#sec-3-3">3.3. Regullar Expression Objects</a></li>
<li><a href="#sec-3-4">3.4. Match Objects</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Control Structions and Functions</a>
<ul>
<li><a href="#sec-4-1">4.1. Control Functions</a></li>
<li><a href="#sec-4-2">4.2. Exception Handling</a></li>
<li><a href="#sec-4-3">4.3. Custom Functions</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. Decorator</a></li>
<li><a href="#sec-4-3-2">4.3.2. Generator</a></li>
<li><a href="#sec-4-3-3">4.3.3. Dynamic Code Execution and Dynamic Imports</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. Partial Function Application</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Closure and Generators</a></li>
<li><a href="#sec-6">6. Packages and Modules</a>
<ul>
<li><a href="#sec-6-1">6.1. Package</a></li>
<li><a href="#sec-6-2">6.2. Module</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Classes</a>
<ul>
<li><a href="#sec-7-1">7.1. class methods and static methods</a></li>
<li><a href="#sec-7-2">7.2. class variables and instance variables</a></li>
<li><a href="#sec-7-3">7.3. Special Methods</a>
<ul>
<li><a href="#sec-7-3-1">7.3.1. <code>__new__()</code> and <code>__init__()</code></a></li>
<li><a href="#sec-7-3-2">7.3.2. <code>__iterator__()</code> and <code>__next__()</code></a></li>
<li><a href="#sec-7-3-3">7.3.3. <code>__str__()</code> and <code>__repr__()</code></a></li>
<li><a href="#sec-7-3-4">7.3.4. <code>__eq__()</code> and other comparisons</a></li>
</ul>
</li>
<li><a href="#sec-7-4">7.4. MRO</a>
<ul>
<li><a href="#sec-7-4-1">7.4.1. <span class="underline"><span class="underline">slots</span></span></a></li>
<li><a href="#sec-7-4-2">7.4.2. Descriptors</a></li>
<li><a href="#sec-7-4-3">7.4.3. property</a></li>
</ul>
</li>
<li><a href="#sec-7-5">7.5. Context Manager</a></li>
<li><a href="#sec-7-6">7.6. Class Decorator</a></li>
<li><a href="#sec-7-7">7.7. Abstract Base Class(ABC)</a></li>
<li><a href="#sec-7-8">7.8. Multiple Inheritance</a></li>
<li><a href="#sec-7-9">7.9. Metaclasses</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Native Data Types</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Identifiers and Keywords</h3>
<div class="outline-text-3" id="text-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Python's Keywords</caption>

<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">and</td>
<td class="left">continue</td>
<td class="left">except</td>
<td class="left">global</td>
<td class="left">lambda</td>
<td class="left">pass</td>
<td class="left">while</td>
</tr>

<tr>
<td class="left">as</td>
<td class="left">def</td>
<td class="left">False</td>
<td class="left">if</td>
<td class="left">None</td>
<td class="left">raise</td>
<td class="left">with</td>
</tr>

<tr>
<td class="left">assert</td>
<td class="left">del</td>
<td class="left">finally</td>
<td class="left">import</td>
<td class="left">nonlocal</td>
<td class="left">return</td>
<td class="left">yield</td>
</tr>

<tr>
<td class="left">break</td>
<td class="left">elif</td>
<td class="left">for</td>
<td class="left">in</td>
<td class="left">not</td>
<td class="left">True</td>
<td class="left">class</td>
</tr>

<tr>
<td class="left">else</td>
<td class="left">from</td>
<td class="left">is</td>
<td class="left">or</td>
<td class="left">try</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Boolean</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Booleans are either <code>True</code> or <code>False</code>. They can be treated as numbers, <code>True</code> is 1; <code>False</code> is 0. 
</p>

<p>
<code>None</code> is false. Zero values are false. Empty list is false. Empty tuple is false. Empty set is false. 
Empty dictionary is false. 
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Numbers</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Numbers can be integers, floats, fractions or even complex numbers.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #DCDCCC; font-weight: bold;">int</span>(<span style="color: #DCDCCC; font-weight: bold;">float</span>(<span style="color: #CC9393;">"2.2"</span>)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">2</span>
11/2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">5.5</span>
11//2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">5</span>
-11//2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">-6</span>
11 ** 2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">121</span>
11 % 2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">1</span>
<span style="color: #DCDCCC; font-weight: bold;">hex</span>(32) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">ox20</span>
<span style="color: #DCDCCC; font-weight: bold;">bin</span>(32) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">0b100000</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Lists</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Lists are ordered sequence of vaues.
</p>
<div class="org-src-container">

<pre class="src src-python">[x**2 <span style="color: #F0DFAF; font-weight: bold;">for</span> x <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">range</span>(5) <span style="color: #F0DFAF; font-weight: bold;">if</span> x%2] <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">[1, 9]</span>

<span style="color: #DFAF8F;">alist</span> = [<span style="color: #CC9393;">"as"</span>, <span style="color: #CC9393;">"12"</span>, 12]

<span style="color: #DFAF8F;">atuple</span> = <span style="color: #DCDCCC; font-weight: bold;">tuple</span>(alist) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">("as", "12", 12)</span>
<span style="color: #DFAF8F;">aset</span> = <span style="color: #DCDCCC; font-weight: bold;">set</span>(alist) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{"as", "12", 12}</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Slicing</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(alist[-1]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">12</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(alist[-1:-2]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">[]</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(alist[-2:-1]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["12"]</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Adding</span>
<span style="color: #DFAF8F;">alist</span> = alist + [<span style="color: #BFEBBF;">True</span>] [<span style="color: #CC9393;">"as"</span>, <span style="color: #CC9393;">"12"</span>, 12, <span style="color: #BFEBBF;">True</span>]
alist.append(3.0) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["as", "12", 12, True, 3.0]</span>
alist.inser(0, 3.0) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">[3.0, "as", "12", 12, True, 3.0, ]</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Searching</span>
alist.count(3.0) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">2</span>
12 <span style="color: #F0DFAF; font-weight: bold;">in</span> alist <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">True</span>
alist.index(12) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">3</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Removing</span>
<span style="color: #F0DFAF; font-weight: bold;">del</span> alist[1] <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">[3.0, "12", 12, True, 3.0]</span>
alist.remove(3.0) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["12", 12, True, 3.0]</span>
alist.pop() <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["12", 12, True]</span>
alist.pop(1) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["12", True]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Tuples</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Tuples are ordered, immutable sequence of values.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">t = (i for i in range(5)) return a generator instead of a tuple</span>
<span style="color: #DFAF8F;">atuple</span> = (<span style="color: #CC9393;">"as"</span>, <span style="color: #CC9393;">"12"</span>, 12)

<span style="color: #DFAF8F;">alist</span> = <span style="color: #DCDCCC; font-weight: bold;">list</span>(atuple) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["as", "12", 12]</span>
<span style="color: #DFAF8F;">aset</span> = <span style="color: #DCDCCC; font-weight: bold;">set</span>(atuple) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{"as", "12", 1}</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Slicing</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(atuple[-1]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">12</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(atuple[-1:-2]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">()</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(atuple[-2:-1]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">("12", )</span>
</pre>
</div>

<p>
A named tuple behaves just like a plain tuple, but it has the ability to refer to items in the tuple by name as well. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #DFAF8F;">Sale</span> = collections.namedtuple(<span style="color: #CC9393;">"Sale"</span>, <span style="color: #CC9393;">"Product Customer Price"</span>)
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">or Sale = collections.namedtuple("Sale", ("Product", "Customer", "Price"))</span>

<span style="color: #DFAF8F;">s</span> = Sale(<span style="color: #CC9393;">"Apple"</span>, <span style="color: #CC9393;">"Howard"</span>, 2.6)
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(s["Customer"]) Error</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(s.Product) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Apple</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">s.Product = "Other" Error</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Sets</h3>
<div class="outline-text-3" id="text-1-6">
<p>
There are two built-in set types: the mutable set type and 
the immutable <i>frozenset</i>. 
</p>

<p>
Sets are unordered bags of values, and always contain unique items.
A set can contain values of any <i>immutable</i> datatype. 
Only <i>hashable</i> objects may be added to <i>set</i>. Hashable objects are objects which have 
<code>__hash__()</code> and can be compared using <code>__eq__()</code>. All the built-in immutable data types, such as 
<i>float</i>, <i>frozenset</i>, <i>int</i>, <i>str</i> and <i>tuple</i>, can be added to sets. The built-ion mutable 
data types, such as <i>dict</i>, <i>list</i> and <i>set</i>, are not hashable, and can not be added to sets. 
</p>

<p>
It supports the standard comparison opeators(&lt;, &lt;=, <code>=, !</code>, &gt;=, &gt;).
</p>
</div>
<div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> set</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
The empty set must be created using <code>set()</code>, empty braces <code>{}</code> used to create an empty dict.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">t = {[1,2]} Error: unhashable type: 'list'</span>

{x+2 <span style="color: #F0DFAF; font-weight: bold;">for</span> x <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">range</span>(5) <span style="color: #F0DFAF; font-weight: bold;">if</span> x%2} <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{3, 5}</span>

<span style="color: #DFAF8F;">aset</span> = {<span style="color: #CC9393;">"as"</span>, <span style="color: #CC9393;">"12"</span>, 12}

<span style="color: #DFAF8F;">alist</span> = <span style="color: #DCDCCC; font-weight: bold;">list</span>(aset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">["as", "12", 12]</span>
<span style="color: #DFAF8F;">atuple</span> = <span style="color: #DCDCCC; font-weight: bold;">set</span>(aset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">("as", "12", 12)</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Adding</span>
aset.add(<span style="color: #BFEBBF;">True</span>) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, "as", "12", 12}</span>
aset.update({12, 3})  <span style="color: #5F7F5F;">#  </span><span style="color: #7F9F7F;">{True, 3, 12, "as", "12"}</span>
aset.update([5,7]) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, 3, 5, 7, 12, 'as', '12'}</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Searching</span>
5 <span style="color: #F0DFAF; font-weight: bold;">in</span> aset <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">True</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Removing</span>
aset.discard5() <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, 3, 7, 12, 'as', '12'}</span>
aset.remove(7) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, 3, 12, 'as', '12'}</span>
aset.pop() <span style="color: #5F7F5F;">#  </span><span style="color: #7F9F7F;">{True, 3, 12, 'as'}</span>

<span style="color: #5F7F5F;"># </span>
<span style="color: #DFAF8F;">bset</span> = {3, <span style="color: #CC9393;">"e3"</span>}
bset.issubset(aset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">False</span>
aset.intersection(bset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{2} not update aset</span>
aset.difference(bset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, 12, 'as'} not update aset</span>
aset.symmetric_difference(bset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{True, 'e3', 12, 'as'} not update aset</span>
aset.union(bset) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">aset = {True, 'e3', 3, 12, 'as'}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2"><span class="section-number-4">1.6.2</span> frozenset</h4>
</div>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Dictionaries</h3>
<div class="outline-text-3" id="text-1-7">
<p>
A dictionary is an unordered set of key-value pair.
</p>

<p>
Only hashable objects may be used as dictionary keys, so immutable data types
(numbers, <i>str</i>, <i>tuple</i>, <i>frozenset</i>) can be.
</p>

<p>
It supports equality comparison operators(<i>==</i> and <i>!=</i>) which are applied item by item.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">md = {t:len(t) for t in [(1,2), "asdf"]} # output {(1,2):2, "asdf":4}</span>
<span style="color: #DFAF8F;">adict</span> = <span style="color: #DCDCCC; font-weight: bold;">dict</span>([(<span style="color: #CC9393;">"server"</span>,<span style="color: #CC9393;">"db.diveintopython3.org"</span>), (<span style="color: #CC9393;">'database'</span>,<span style="color: #CC9393;">'mysql'</span>)])
<span style="color: #DFAF8F;">adict</span> = <span style="color: #DCDCCC; font-weight: bold;">dict</span>(server=<span style="color: #CC9393;">"db.diveintopython3.org"</span>, database=<span style="color: #CC9393;">'mysql'</span>)
<span style="color: #DFAF8F;">adict</span> = {<span style="color: #CC9393;">"server"</span>:<span style="color: #CC9393;">"db.diveintopython3.org"</span>, <span style="color: #CC9393;">'database'</span>:<span style="color: #CC9393;">'mysql'</span>}

adict[<span style="color: #CC9393;">'server'</span>] <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">"db.diveintopython3.org"</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> k <span style="color: #F0DFAF; font-weight: bold;">in</span> adict:
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(k)  <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">print each key</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> v <span style="color: #F0DFAF; font-weight: bold;">in</span> adict.values():
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(v)  <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">print each value</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> item adict.items():
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(item)  <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">print each key-value pair in tuple</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> key, value <span style="color: #F0DFAF; font-weight: bold;">in</span> adict.items():
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"({0},{1})"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(key, value)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">print each key-value pair in tuple</span>

<span style="color: #DFAF8F;">adict</span>[<span style="color: #CC9393;">'database'</span>] = <span style="color: #CC9393;">'oracle'</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{"server":"db.diveintopython3.org", 'database':'oracle'}</span>

adict(<span style="color: #CC9393;">'user'</span>) = <span style="color: #CC9393;">'howard'</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{"server":"db.diveintopython3.org", "user":"howard", 'database':'mysql'}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> None</h3>
<div class="outline-text-3" id="text-1-8">
<p>
<code>None</code> is special constant in Python, it is not <code>False</code>, not 0, not empty string. Comparing <code>None</code> to anything other 
than <code>None</code> will always return <code>False</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Strings</h2>
<div class="outline-text-2" id="text-2">
<p>
Strings are immutable sequences of Unicode characters.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #DFAF8F;">s</span> = <span style="color: #CC9393;">'''qqqqq or</span>
<span style="color: #CC9393;">1111'''</span>

s.splitlines() <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">['qqqqq or', '1111']</span>
s.lower().count(<span style="color: #CC9393;">'q'</span>) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">5</span>
s.split(<span style="color: #CC9393;">"or"</span>) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">['qqqqq ', '\n1111']</span>
s[4:7] <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">"q o"</span>
s[7:] <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">'r\n1111'</span>

<span style="color: #CC9393;">"{0.__class__}"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(1) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">"&lt;class 'int'&gt;"</span>
<span style="color: #CC9393;">"{var.__class__}"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(var=1) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">"&lt;class 'int'&gt;"</span>

<span style="color: #DFAF8F;">h</span> = {<span style="color: #CC9393;">"s1"</span>: <span style="color: #CC9393;">"11"</span>, <span style="color: #CC9393;">"s2"</span>:22} <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">keys must be string, cannot be tuple</span>
<span style="color: #CC9393;">"{s1} {s2}"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(**h)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> regular expressions</h2>
<div class="outline-text-2" id="text-3">
<p>
Example
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> re

<span style="color: #DFAF8F;">astring</span> = <span style="color: #CC9393;">" howard@google.com.cn Gorman@baidu.net"</span>

<span style="color: #DFAF8F;">pattern</span> = <span style="color: #CC9393;">"(?P&lt;Name&gt;\w+)@(?P&lt;Company&gt;\w+)(?:\.\w+)+"</span>
<span style="color: #DFAF8F;">flags</span> = re.IGNORECASE

<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"re.findall():"</span>, re.findall(pattern, astring, flags)) 

<span style="color: #DFAF8F;">mt</span> = re.search(pattern, astring, flags)
<span style="color: #DFAF8F;">s</span> = <span style="color: #CC9393;">"\nre.search():%s\n"</span>%mt.__class__
<span style="color: #DFAF8F;">s</span> += <span style="color: #CC9393;">"\tmt.groups():%s, mt.group(1):%s"</span>%(mt.groups(), mt.group(1))
<span style="color: #F0DFAF; font-weight: bold;">print</span>(s)

<span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">The difference between re.search() and re.match(),</span>
<span style="color: #CC9393;">re.search() try to match anywhere of astring,</span>
<span style="color: #CC9393;">re.search() just match the start of astring</span>
<span style="color: #CC9393;">'''</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"\nre.match():"</span>, re.match(pattern, astring, flags)) 

<span style="color: #DFAF8F;">m1</span> = re.finditer(pattern, astring, flags)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"\nre.finditer():"</span>, m1)
<span style="color: #F0DFAF; font-weight: bold;">for</span> i, m <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(m1):
    <span style="color: #DFAF8F;">s1</span> = <span style="color: #CC9393;">"\tm.__class__:%s \n"</span>%m.__class__
    <span style="color: #DFAF8F;">s1</span> += <span style="color: #CC9393;">"\t\tm.start({0}): {1}, m.start({0}): {2}\n"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(i, m.start(i), m.end(i))
    <span style="color: #DFAF8F;">s1</span> += <span style="color: #CC9393;">"\t\tm.groupdict():%s\n"</span>%m.groupdict()
    <span style="color: #DFAF8F;">s1</span> += <span style="color: #CC9393;">"\t\tm.groups():{0}, \n"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(m.groups()) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">"%s"%tuple does not work</span>
    <span style="color: #DFAF8F;">s1</span> += <span style="color: #CC9393;">"\t\tm.lastindex:%d\n"</span>%m.lastindex <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">the number of the highest capturing group</span>
    <span style="color: #DFAF8F;">s1</span> += <span style="color: #CC9393;">"\t\tm.group(Name):%s, m.group(Company):%s\n"</span>%(m.group(<span style="color: #CC9393;">"Name"</span>), m.group(<span style="color: #CC9393;">"Company"</span>))
    <span style="color: #DFAF8F;">s1</span> += m.expand(<span style="color: #CC9393;">"\t\t\g&lt;Name&gt; work for \g&lt;Company&gt;"</span>) 
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(s1)

<span style="color: #DFAF8F;">rx</span> = re.<span style="color: #DCDCCC; font-weight: bold;">compile</span>(pattern, flags)
<span style="color: #DFAF8F;">s2</span>  = <span style="color: #CC9393;">"\nrx=re.compile():%s\n"</span>%rx.__class__
<span style="color: #DFAF8F;">s2</span> += <span style="color: #CC9393;">"\trx.pattern:%s"</span>%rx.pattern
<span style="color: #DFAF8F;">s2</span> += <span style="color: #CC9393;">", rx.flags:%s"</span>%rx.flags
<span style="color: #DFAF8F;">s2</span> += <span style="color: #CC9393;">", rx.groupindex:%s\n"</span>%rx.groupindex
<span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">You have to make it match from index 1 of astring, otherwise, it returns None,</span>
<span style="color: #CC9393;">'''</span>
<span style="color: #DFAF8F;">s2</span> += <span style="color: #CC9393;">"\trx.match(astring, 1):%s"</span>%rx.match(astring, 1).__class__
<span style="color: #F0DFAF; font-weight: bold;">print</span>(s2)

<span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">Both re and rx have function: findall(), finditer(), match(), search(),</span>
<span style="color: #CC9393;">and the parameters for these 4 function are same no matter they are of re or rx.</span>
<span style="color: #CC9393;">The meaning of each function of them is consistent no matter in re or in rx. </span>
<span style="color: #CC9393;">In re, the parameters are pattern, astring and flags, you can see above.</span>
<span style="color: #CC9393;">In rx, the parameters are astring, startindex of astring, and endindex of astring</span>
<span style="color: #CC9393;">'''</span>
</pre>
</div>
<p>
output:
</p>
<div class="org-src-container">

<pre class="src src-cmd">re.findall(): [('howard', 'google'), ('Gorman', 'baidu')]

re.search():&lt;class '_sre.SRE_Match'&gt;
	mt.groups():('howard', 'google'), mt.group(1):howard

re.match(): None

re.finditer(): &lt;callable_iterator object at 0x00000000027E6E48&gt;
	m.__class__:&lt;class '_sre.SRE_Match'&gt; 
		m.start(0): 1, m.start(0): 21
		m.groupdict():{'Name': 'howard', 'Company': 'google'}
		m.groups():('howard', 'google'), 
		m.lastindex:2
		m.group(Name):howard, m.group(Company):google
		howard work for google
	m.__class__:&lt;class '_sre.SRE_Match'&gt; 
		m.start(1): 22, m.start(1): 28
		m.groupdict():{'Name': 'Gorman', 'Company': 'baidu'}
		m.groups():('Gorman', 'baidu'), 
		m.lastindex:2
		m.group(Name):Gorman, m.group(Company):baidu
		Gorman work for baidu

rx=re.compile():&lt;class '_sre.SRE_Pattern'&gt;
	rx.pattern:(?P&lt;Name&gt;\w+)@(?P&lt;Company&gt;\w+)(?:\.\w+)+, rx.flags:34, rx.groupindex:{'Name': 1, 'Company': 2}
	rx.match(astring, 1):&lt;class '_sre.SRE_Match'&gt;
</pre>
</div>
</div>
<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Regular Expression</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Some special characters, such as '.', '<sup>'</sup>, are skipped here, others are list below
</p>
<ul class="org-ul">
<li>'(?:&#x2026;)', Non-capturing version of regular parentheses. The substring matched by the group cannot be rettrieved 
after performing a match or referenced later in the pattern.
</li>
<li>'(?:P&lt;name&gt;)', the substring matched by the group is accessible via the symbolic group name <i>name</i>.
</li>
<li>'(?P=name)', A backrefernce to a named group, it matches whatever text was matched by the earlier group named <i>name</i>
</li>
<li>'(?#&#x2026;)', A comment, the content of the parentheses are simply ignored.
</li>
<li>'(?=&#x2026;)', lookahead assertion. 

<p>
Example, <i>Isaac(?=Asimov)</i> will match <i>Isaac</i> only if it is followed by <i>Asimov</i>.
</p>
</li>
<li>'(?!&#x2026;)' Negative lookahead assertion.  

<p>
Example, <i>Isaac(?!Asimov)</i> will match <i>Isaac</i> only if it is not followed by <i>Asimov</i>.
</p>
</li>
<li>'(?&lt;=&#x2026;.)', Positive lookbehind assertion. 

<p>
Example, <i>(?&lt;=abc)def</i> will find a match in <i>abcdef</i>, since it will look back <b>3</b> characters 
and check if the contained patten matches.
</p>
</li>
<li>'(?&lt;!&#x2026;)', Negative lookbehind assertion
</li>
<li>'(?(id/name)yes-pattern|no-pattern)', match with <i>yes-pattern</i> if the group with given <i>id</i> or <i>name</i> exists, 
and with <i>no-pattern</i> if it doesn't. <i>no-pattern</i> is optional.

<p>
Example, <i>^(&lt;)?(\w+@\w+(?:\.\w+)+)(?(1)&gt;|$)</i> will match <i>&lt;user@host.com.cn&gt;</i>, <i>user@host.com.cn</i>, but not with 
<i>&lt;user@host.com.cn</i>, <i>user@host.com.cn&gt;</i>.
</p>
</li>
</ul>

<p>
These special characters can be applied to Ruby as well.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Module Contents</h3>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Regullar Expression Objects</h3>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Match Objects</h3>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Control Structions and Functions</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Control Functions</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">if</span> boolean_expression1:
  suite1
<span style="color: #F0DFAF; font-weight: bold;">elif</span> boolean_expression2:
  suite2
<span style="color: #F0DFAF; font-weight: bold;">else</span>:
  suite3

expression1 <span style="color: #F0DFAF; font-weight: bold;">if</span> boolean_expression1 <span style="color: #F0DFAF; font-weight: bold;">else</span> expression2

<span style="color: #F0DFAF; font-weight: bold;">while</span> boolean_expression:
  suite1
<span style="color: #F0DFAF; font-weight: bold;">else</span>: 
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">If the loop above does not terminate normally(break statement, return statement or exception), suite2 is skipped.</span>
  suite2

<span style="color: #F0DFAF; font-weight: bold;">for</span> expression <span style="color: #F0DFAF; font-weight: bold;">in</span> iterable:
  suite1
<span style="color: #F0DFAF; font-weight: bold;">else</span>:
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">If the loop above does not terminate normally(break statement, return statement or exception), suite2 is skipped.</span>
  suite2
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Exception Handling</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">try</span>:
  suite1
<span style="color: #F0DFAF; font-weight: bold;">except</span> exceptionType <span style="color: #F0DFAF; font-weight: bold;">as</span> variable:
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">exceptionType can be tuple of multiple exception types. "as variable" is optional</span>
  suite2
<span style="color: #F0DFAF; font-weight: bold;">else</span>:
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">optional. run suite3 if no exception found in suite1</span>
  suite3
<span style="color: #F0DFAF; font-weight: bold;">finally</span>:
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">optional. always run suite4 even if return statement run before</span>
  suite4

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">exceptionType1</span>(<span style="color: #7CB8BB;">Exception</span>): <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">base exception could be Exception or its sub class</span>
  <span style="color: #F0DFAF; font-weight: bold;">pass</span> 

<span style="color: #F0DFAF; font-weight: bold;">try</span>:
  <span style="color: #F0DFAF; font-weight: bold;">raise</span> exceptionType1(<span style="color: #CC9393;">"customed"</span>)
<span style="color: #F0DFAF; font-weight: bold;">except</span> exceptionType1 <span style="color: #F0DFAF; font-weight: bold;">as</span> v1:
  <span style="color: #CC9393;">''' output from print below (even if v1 above is declared as type of Exception)</span>
<span style="color: #CC9393;">  &lt;class '__main__.exceptionType1'&gt;(customed)</span>
<span style="color: #CC9393;">  '''</span>
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(v1.__class__, <span style="color: #CC9393;">", "</span>, v1) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&lt;class '__main__.exceptionType1'&gt; even if v1 is type of Exception</span>
  <span style="color: #F0DFAF; font-weight: bold;">try</span>:
    <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">Exception</span>(<span style="color: #CC9393;">"raise again"</span>) <span style="color: #F0DFAF; font-weight: bold;">from</span> v1
  <span style="color: #F0DFAF; font-weight: bold;">except</span> <span style="color: #7CB8BB;">Exception</span> <span style="color: #F0DFAF; font-weight: bold;">as</span> v2:
    <span style="color: #CC9393;">''' output from 2 prints below</span>
<span style="color: #CC9393;">    &lt;class 'Exception'&gt;(raise again) caused by:</span>
<span style="color: #CC9393;">            &lt;class '__main__.exceptionType1'&gt;(customed)</span>
<span style="color: #CC9393;">    '''</span>
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"%s(%s) caused by:"</span>%(v2.__class__, v2))
    <span style="color: #DFAF8F;">v3</span> = v2.__cause__
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"\t%s(%s)"</span>%(v3.__class__, v3))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Custom Functions</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Four kinds of functions: global functions, local functions(nested functions), lambda functions, and methods.
</p>

<p>
All function return a value, it will return <code>None</code> if the function does not execute <code>return</code> statement.
</p>

<p>
It allows function arguments to have default values. Arguments can be specified in any order by 
using name arguments. As soon as you have a named argument, all arguments to the right of that need to 
be named arguments, too. We can use the sequence unpacking operator * to supply positional arguments. 
Also we can unpack a mapping using the mapping unpacking operator ** to supply keyword arguments.
</p>

<p>
It is best not to use global variables except as constant, if you have to, please use <code>global</code> statement.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">The lambda function can not contain branches or loops(although conditional expressions are allowed),</span>
<span style="color: #CC9393;">and can not have a return(or yield) statement. </span>
<span style="color: #CC9393;">'''</span>
<span style="color: #DFAF8F;">s</span> = <span style="color: #F0DFAF; font-weight: bold;">lambda</span> x, y: {<span style="color: #CC9393;">"min"</span>:x, <span style="color: #CC9393;">"max"</span>:y} <span style="color: #F0DFAF; font-weight: bold;">if</span> x&lt;y <span style="color: #F0DFAF; font-weight: bold;">else</span> {<span style="color: #CC9393;">"min"</span>:y, <span style="color: #CC9393;">"max"</span>:x}
s(3,2) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">{'min': 2, 'max': 3}</span>
</pre>
</div>
</div>
<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Decorator</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
A decorator is a function that takes a function or method as its sole argument and returns a new function or 
method that incorporates the decorated function or method with some additional functionality added.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">decorator_maker_with_arguments</span>(s):
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"decorator_maker_with_arguments: "</span>, s)

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">my_decorate</span>(func):
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"my_decorate "</span>, s)
        <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">wrapper</span>(x):
            <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"Before %s(%s)"</span>%(func.<span style="color: #DCDCCC; font-weight: bold;">__name__</span>, x))
            func(x)
            <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"After %s(%s)"</span>%(func.<span style="color: #DCDCCC; font-weight: bold;">__name__</span>, x))

        <span style="color: #F0DFAF; font-weight: bold;">return</span> wrapper

    <span style="color: #F0DFAF; font-weight: bold;">return</span> my_decorate


<span style="color: #7CB8BB;">@decorator_maker_with_arguments</span>(<span style="color: #CC9393;">"arguments"</span>)
<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">lazy_func</span>(x):
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"lazy_func(%s)"</span>%x)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">it is equal to decorator_maker_with_arguments("arguments")(lazy_func)("test") </span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">when no @decorator_maker_with_arguments("arguments")</span>
lazy_func(<span style="color: #CC9393;">"test"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> Generator</h4>
<div class="outline-text-4" id="text-4-3-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #DFAF8F;">h</span> = {1:1, 3:3, 2:2}

<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">g = ((key, h[key]) for key in sorted(h)) # It is not a tuple, it is a generator</span>

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">generator</span>(d):
    <span style="color: #F0DFAF; font-weight: bold;">for</span> key <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">sorted</span>(d):
        <span style="color: #DFAF8F;">rcv</span> = <span style="color: #F0DFAF; font-weight: bold;">yield</span> key, d[key]
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"rcv: "</span>, rcv)

<span style="color: #DFAF8F;">g1</span> = generator(h)
<span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> g1: <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">repeat calling g1.next() until StopIteration</span>
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(i)
    <span style="color: #F0DFAF; font-weight: bold;">print</span>()
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"############"</span>)

<span style="color: #DFAF8F;">g2</span> = generator(h)
<span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">range</span>(3):
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #DCDCCC; font-weight: bold;">next</span>(g2)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">g2.next() is called</span>
    <span style="color: #F0DFAF; font-weight: bold;">print</span>()
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"############"</span>)

<span style="color: #DFAF8F;">g3</span> = generator(h)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(g3.send(<span style="color: #BFEBBF;">None</span>)) 
<span style="color: #F0DFAF; font-weight: bold;">for</span> i <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #DCDCCC; font-weight: bold;">range</span>(2):
    <span style="color: #F0DFAF; font-weight: bold;">print</span>()
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(g3.send(i))
</pre>
</div>
<p>
Generator's methods
</p>
<ul class="org-ul">
<li><code>generator.next()</code>

<p>
start the execution of a generator or resume the execution, 
returns with value of <code>yield</code> expression or raises StopIteration.
</p>
</li>
<li><code>generator.send(v)</code>

<p>
It can start a generator by using <code>None</code> as argument. It can resume the execution.
It keeps argument <code>v</code> as the result of <code>yield</code> expression, and returns value of <code>yield</code> expression.
It could raise StopIteration.
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> Dynamic Code Execution and Dynamic Imports</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
To create a function dynamically, we can use built-in <code>exec(object[, globals[,locals]])</code>.
<i>object</i> could be either a string or a code object. The return value of <code>exec</code> function 
is <code>None</code>. In the <i>object</i>, it has no access of any imported modules, any functions or 
variables, any other objects in the scope of the <code>exec</code> call. These problems addressed 
by providing the other two arguments(they are dictionaries). The reference to the generated 
function is added into the <i>locals</i> argument of <code>exec</code> function, if no <i>locals</i> provided, then 
take <i>globals</i> as <i>locals</i> too.
</p>

<p>
<code>exec</code> function can handle any amount of code whereas <code>eval</code> function evaluate a single expression. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> math

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">outer</span>(oarg):
  <span style="color: #DFAF8F;">code</span> = <span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">def inner(iarg): </span>
<span style="color: #CC9393;">  print("oarg: %d, iarg: %d"%(oarg, iarg))</span>
<span style="color: #CC9393;">  return math.pi * iarg * oarg </span>
<span style="color: #CC9393;">  '''</span>

  <span style="color: #DFAF8F;">ctxt</span> = {}
  <span style="color: #DFAF8F;">ctxt</span>[<span style="color: #CC9393;">"math"</span>] = math
  <span style="color: #DFAF8F;">ctxt</span>[<span style="color: #CC9393;">"oarg"</span>] = oarg
  <span style="color: #F0DFAF; font-weight: bold;">exec</span>(code, ctxt)
  <span style="color: #DFAF8F;">inner</span> = ctxt[<span style="color: #CC9393;">"inner"</span>]
  <span style="color: #F0DFAF; font-weight: bold;">print</span>(inner(3))

outer(2)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Partial Function Application</h3>
<div class="outline-text-3" id="text-4-4">
<p>
It is the creation of a function from an existing function and some arguments to produce a new function that 
does what the original function did, but with some arguments fixed so that callers do not have to pass them.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> functools

<span style="color: #DFAF8F;">seasons</span> = (<span style="color: #CC9393;">"Spring"</span>, <span style="color: #CC9393;">"Summer"</span>, <span style="color: #CC9393;">"Fall"</span>, <span style="color: #CC9393;">"Winter"</span>)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #DCDCCC; font-weight: bold;">list</span>(<span style="color: #DCDCCC; font-weight: bold;">enumerate</span>(seasons)))

<span style="color: #DFAF8F;">enumerate1</span> = functools.partial(<span style="color: #DCDCCC; font-weight: bold;">enumerate</span>, start=1)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #DCDCCC; font-weight: bold;">list</span>(enumerate1(seasons)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Closure and Generators</h2>
<div class="outline-text-2" id="text-5">
<p>
Generators are just a simple form of iterators.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">rules</span>():
    <span style="color: #F0DFAF; font-weight: bold;">for</span> k, v <span style="color: #F0DFAF; font-weight: bold;">in</span> {<span style="color: #CC9393;">"a"</span>:1, <span style="color: #CC9393;">"b"</span>: 2,<span style="color: #CC9393;">"c"</span>:3}.items():
        <span style="color: #F0DFAF; font-weight: bold;">yield</span> k, v   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">unlike ruby, it</span>

<span style="color: #F0DFAF; font-weight: bold;">for</span> key, value <span style="color: #F0DFAF; font-weight: bold;">in</span> rules():
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"key: "</span>, key, <span style="color: #CC9393;">", value: "</span>, value)
    value
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Packages and Modules</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Package</h3>
<div class="outline-text-3" id="text-6-1">
<p>
A package is simply a directory that contains a set of modules and a file called <i><span class="underline"><span class="underline">init</span></span>.py</i>, and <i><span class="underline"><span class="underline">init</span></span>.py</i> 
could be blank, or contain a list(named <i><span class="underline"><span class="underline">all</span></span></i>) of modules in the directory which will be imported whem 
<code>from package import *</code> used.
</p>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Module</h3>
<div class="outline-text-3" id="text-6-2">
<p>
A python module, in general, is a <i>.py</i> file. Not all modules have associated <i>.py</i> files, like some built-in modules 
and modules written in other languages. Modules could contain as many class definations as we like. 
</p>

<p>
We can use <code>import</code> to import package or modules in a package. It is recomended to import standard library 
modules first, then third-party library modules, and fianlly our own modules.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> os 
<span style="color: #F0DFAF; font-weight: bold;">print</span>(os.path.basename(filename)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">safe fully qualified access </span>

<span style="color: #F0DFAF; font-weight: bold;">import</span> os.path <span style="color: #F0DFAF; font-weight: bold;">as</span> path
<span style="color: #F0DFAF; font-weight: bold;">print</span>(path.basename(filename)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">risk of name collision with path</span>

<span style="color: #F0DFAF; font-weight: bold;">from</span> os <span style="color: #F0DFAF; font-weight: bold;">import</span> path
<span style="color: #F0DFAF; font-weight: bold;">print</span>(path.basename(filename)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">risk of name collision with path</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">* means everything that is not private, or all objects named in global __all__ variable if __all__ is provided</span>
<span style="color: #F0DFAF; font-weight: bold;">from</span> os.path <span style="color: #F0DFAF; font-weight: bold;">import</span> * 
<span style="color: #F0DFAF; font-weight: bold;">print</span>(basename(filename)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">risk of many name collision</span>
</pre>
</div>
<p>
When you try to import a module, it looks in all the directories defined in <code>sys.path</code> that is just a list and you 
can modify it with standard list methods.
</p>

<p>
Modules are objects, and have a built-in attribute <code>__name__</code>. If you import the module, then <code>__name__</code> is the 
module's filename, without a directory path or file extension. If you run the module directly, <code>__name__</code> is 
<code>__main__</code>. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Classes</h2>
<div class="outline-text-2" id="text-7">
<p>
Everything in Python is an object, classes are objects, too.
</p>

<p>
Class names do not have to match module names. It is recomended to use an upercase letter as the first 
letter of custom modules and custom classes.
</p>

<p>
All classes are drived directly or indirectly from the ultimate base class <code>object</code>.
</p>

<p>
Python does not provide: overloading and access control. The attributes that begin with two leading underscore 
will prevent unintentional accesses so that they can be considered to be private(Actually, they are kept in the 
name like <i>_classname_<sub>attribute</sub></i>, and can be accessed).
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> class methods and static methods</h3>
<div class="outline-text-3" id="text-7-1">
<p>
class methods are set up by using the built-in <code>classmethod</code> function as a decorator, but you do not have to put 
<code>@classmethod</code> before the defination of <code>__new__()</code>, because python knows it. class methods have their firsst 
argument added by python and it is the class the class methods defined in.
</p>

<p>
static methods are set up by using the built-in <code>staticmethod</code> function as a decorator, they have no first argument 
added automatically by python. 
</p>

<p>
instance methods have their first argument added by python and it is the instance the method was called on.
</p>

<p>
All these 3 kinds of methods get any other arguments we pass to them.
</p>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> class variables and instance variables</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Lazy</span>:
    <span style="color: #DFAF8F;">rule</span> = <span style="color: #CC9393;">"DefaultClassVariable"</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">create class variabe inside the class defination, but outside of definations of methods</span>
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">self.rule = "DefaultInstanceVariable" # create an instance variable</span>
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"\t"</span>, <span style="color: #F0DFAF; font-weight: bold;">self</span>.rule) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">if no instance variable, refer to class variable</span>

<span style="color: #DFAF8F;">a</span> = Lazy()
<span style="color: #DFAF8F;">b</span> = Lazy()
<span style="color: #F0DFAF; font-weight: bold;">print</span>()

<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.rule) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">if no instance variable, refer to class variable</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.rule) <span style="color: #5F7F5F;"># </span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.__class__.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.__class__.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>()

<span style="color: #DFAF8F;">a.rule</span> = <span style="color: #CC9393;">"InstanceVariable"</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">create an instance variable just for a</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.__class__.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.__class__.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>()

<span style="color: #DFAF8F;">a.__class__.rule</span> = <span style="color: #CC9393;">"ClassVariable"</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">explicitely refer to class variable</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(a.__class__.rule)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(b.__class__.rule)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Special Methods</h3>
<div class="outline-text-3" id="text-7-3">
</div><div id="outline-container-sec-7-3-1" class="outline-4">
<h4 id="sec-7-3-1"><span class="section-number-4">7.3.1</span> <code>__new__()</code> and <code>__init__()</code></h4>
<div class="outline-text-4" id="text-7-3-1">
<p>
When an object is created, first <code>__new__()</code> is called, then <code>__init()__</code> is called to initialize it.
</p>

<p>
<code>__init__</code> method is called immediately after an instance of the class is created. As with other method, the first 
argument of <code>__init__</code> is always a refernce to the current instance of the class, and, by convention, the argument 
is named <i>self</i>.
</p>
</div>
</div>

<div id="outline-container-sec-7-3-2" class="outline-4">
<h4 id="sec-7-3-2"><span class="section-number-4">7.3.2</span> <code>__iterator__()</code> and <code>__next__()</code></h4>
<div class="outline-text-4" id="text-7-3-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Fib</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, <span style="color: #DCDCCC; font-weight: bold;">max</span>):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.<span style="color: #DCDCCC; font-weight: bold;">max</span> = <span style="color: #DCDCCC; font-weight: bold;">max</span>;

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__iter</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.a = 0
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.b = 1
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__next__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #DFAF8F;">fib</span> = <span style="color: #F0DFAF; font-weight: bold;">self</span>.a
        <span style="color: #F0DFAF; font-weight: bold;">if</span> fib&gt;<span style="color: #F0DFAF; font-weight: bold;">self</span>.<span style="color: #DCDCCC; font-weight: bold;">max</span>:
            <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">StopIteration</span>
        <span style="color: #DFAF8F;">seld.a</span>, <span style="color: #F0DFAF; font-weight: bold;">self</span>.b = <span style="color: #F0DFAF; font-weight: bold;">self</span>.b, <span style="color: #F0DFAF; font-weight: bold;">self</span>.a+<span style="color: #F0DFAF; font-weight: bold;">self</span>.b
        <span style="color: #F0DFAF; font-weight: bold;">return</span> fib
</pre>
</div>

<p>
An iterator is just a class that defines an <code>__iter__</code> method, which returns an object that implements a <code>__next__</code> 
method, in most cases, <code>__iter__</code> method returns <i>self</i>, since the class implements <code>__iter__</code> method also 
implements its own <code>__next__</code> method.
</p>

<p>
<code>__next__</code> method is called whenever someone calls <code>next()</code> on an iterator of an instance of a class, it raises 
<code>StopIteration</code> exception when the iteration is exhausted. As for <code>for</code> loop, it will exit the loop when noticing 
the exception.
</p>
</div>
</div>

<div id="outline-container-sec-7-3-3" class="outline-4">
<h4 id="sec-7-3-3"><span class="section-number-4">7.3.3</span> <code>__str__()</code> and <code>__repr__()</code></h4>
<div class="outline-text-4" id="text-7-3-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Point</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, x, y):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.x, <span style="color: #F0DFAF; font-weight: bold;">self</span>.y = x, y

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__str__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__repr__()

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__repr__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"{0.__class__.__name__}({0.x}, {0.y})"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>)

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Circle</span>(Point):
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, radius, x=0, y=0):
        <span style="color: #DCDCCC; font-weight: bold;">super</span>().__init__(x, y)
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.radius = radius

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__str__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__repr__()

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__repr__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"{0.__class__.__name__}({0.radius}, {0.x}, {0.y})"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>)


<span style="color: #DFAF8F;">c</span> = Circle(5,3,4)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(c)

<span style="color: #F0DFAF; font-weight: bold;">if</span> c.__module__ == <span style="color: #CC9393;">"__main__"</span>:
  <span style="color: #DFAF8F;">d</span> = <span style="color: #DCDCCC; font-weight: bold;">eval</span>(<span style="color: #DCDCCC; font-weight: bold;">repr</span>(c)) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">eval("Circle(5,3,4)")</span>
<span style="color: #F0DFAF; font-weight: bold;">else</span>:
  <span style="color: #DFAF8F;">d</span> = <span style="color: #DCDCCC; font-weight: bold;">eval</span>(c.__module__+<span style="color: #CC9393;">"."</span>+<span style="color: #DCDCCC; font-weight: bold;">repr</span>(c))

<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"id of {0} is {1}\nid of {2} is {3}"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(c, <span style="color: #DCDCCC; font-weight: bold;">hex</span>(<span style="color: #DCDCCC; font-weight: bold;">id</span>(c)), d, <span style="color: #DCDCCC; font-weight: bold;">hex</span>(<span style="color: #DCDCCC; font-weight: bold;">id</span>(d))))

<span style="color: #CC9393;">''' output:</span>
<span style="color: #CC9393;">Circle(5, 3, 4)</span>
<span style="color: #CC9393;">id of Circle(5, 3, 4) is 0x28124a8</span>
<span style="color: #CC9393;">id of Circle(5, 3, 4) is 0x2812550</span>
<span style="color: #CC9393;">'''</span>
</pre>
</div>

<p>
To call the base version of a method inside a reimplemented method, we can do so using the <code>super()</code>.
</p>

<p>
The functions <code>__str__()</code> and <code>__repr__()</code> are called by built-in function <code>str()</code> and <code>repr()</code> respectively. 
The result of <code>repr()</code> is intended to be passed to <code>eval()</code> to produce an object equivalent to the one <code>repr()</code> 
was called on.
</p>
</div>
</div>

<div id="outline-container-sec-7-3-4" class="outline-4">
<h4 id="sec-7-3-4"><span class="section-number-4">7.3.4</span> <code>__eq__()</code> and other comparisons</h4>
<div class="outline-text-4" id="text-7-3-4">
<p>
By default, all instances of custom classes are hashable, so they can be used as dictionary keys and stored in sets. 
But if we reimplement <code>__eq__()</code>, instances are no longer hashable.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">A</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__eq__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, other):
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"A __eq__ called: %r == %r"</span>%(<span style="color: #F0DFAF; font-weight: bold;">self</span>, other))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.va == other <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">you can try to return NotImplemented, True, etc</span>

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">B</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__eq__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, other):
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"B __eq__ called: %r == %r"</span>%(<span style="color: #F0DFAF; font-weight: bold;">self</span>, other))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.vb == other <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">you can try to return NotImplemented, True, etc</span>

<span style="color: #DFAF8F;">a</span> = A()
<span style="color: #DFAF8F;">a.va</span> = 3 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">it is int, do not know how to compare itself to B</span>

<span style="color: #DFAF8F;">b</span> = B()
<span style="color: #DFAF8F;">b.vb</span> = 4

<span style="color: #F0DFAF; font-weight: bold;">print</span>(a==b)
</pre>
</div>

<p>
When a==b, it tries the following:
</p>
<ul class="org-ul">
<li>if <code>type(b)</code> is a new-style class, and <code>type(b)</code> is a subclass of <code>type(a)</code>, and <code>type(b)</code> has overriden <code>__eq__</code>, 
then the result is <code>b.__eq__(a)</code>
</li>
<li>if <code>type(a)</code> has overriden <code>__eq__</code> (that is, <code>type(a).__eq__</code> is not <code>object.__eq__</code>), then the result is <code>a.__eq__(b)</code>
</li>
<li>if <code>type(b)</code> has overriden <code>__eq__</code>, the the result is <code>b.__eq__(a)</code>
</li>
<li>if none of the above are the case, it repeats the process looking for <code>__cmp__</code>. if it exists, the objects are equal if it return <code>zero</code>
</li>
<li>As a final fallback, it calls <code>object.__eq__(a,b)</code> which is <code>True</code> if <code>a</code> and <code>b</code> are the same object, that is same as <code>a is b</code>
</li>
</ul>

<p>
If any of the special methods return <code>NotImplemented</code>, it acts as though the method did not exist.
</p>

<p>
To provide the complete set of comparisons(&lt;, &lt;=, <code>=, !</code>, &gt;, &gt;=), it is nessary to implement at least three of them: 
&lt;, &lt;= and ==.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> MRO</h3>
<div class="outline-text-3" id="text-7-4">
<p>
MRO stands for Method(attribute) Resolution Order.
</p>

<p>
Here is the general procedure for access to attribute <i>a</i> of instance <i>i</i>, where <i>C</i> is the class of <i>i</i>.
</p>
<ul class="org-ul">
<li>Execute <code>__getattribute__()</code> of the instance, it returns either the attribute value or raise <i>AttributeError</i>.
<ul class="org-ul">
<li>return <code>C.__dict__['a'].__get__(i, C)</code> if <code>C.__dict__</code> contains 'a' that is a data descriptor
</li>
<li>return <code>i.__dict__['a']</code> if <i>i</i> contains 'a' 
</li>
<li>return <code>C.__dict__['a']</code> if <code>C.__dict__</code> contains 'a' that is not a data descriptor
</li>
<li>invoke <code>__getattribute__</code> of the base class
</li>
</ul>
</li>
<li>Execute <code>a.__getattr__()</code> if <code>__getattribute__()</code> raises <code>AttributeError</code>.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"> <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Child</span>():
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__getattr__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, name):
        <span style="color: #F0DFAF; font-weight: bold;">if</span> name == <span style="color: #CC9393;">"foo"</span>:
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"Fifth"</span>    

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">getattribute1</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, name):
    <span style="color: #F0DFAF; font-weight: bold;">if</span> name == <span style="color: #CC9393;">"foo"</span>:
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">"First"</span>
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #DCDCCC; font-weight: bold;">object</span>.__getattribute__(<span style="color: #F0DFAF; font-weight: bold;">self</span>, name)

<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">getattribute2</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, name):
    <span style="color: #F0DFAF; font-weight: bold;">if</span> name == <span style="color: #CC9393;">"foo"</span>:
        <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">AttributeError</span>(<span style="color: #CC9393;">"as"</span>)
    <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #DCDCCC; font-weight: bold;">object</span>.__getattribute__(<span style="color: #F0DFAF; font-weight: bold;">self</span>, name)

<span style="color: #DFAF8F;">bar</span> = Child()

<span style="color: #DFAF8F;">Child.foo</span> = <span style="color: #CC9393;">"Fourth"</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.__class__.__dict__, bar.__dict__)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.foo) <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(Child.__dict__['foo'])</span>

<span style="color: #DFAF8F;">bar.foo</span> = <span style="color: #CC9393;">"Third"</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.__class__.__dict__, bar.__dict__)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.foo) <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(bar.__dict__['foo'])</span>

<span style="color: #DFAF8F;">Child.foo</span> = <span style="color: #DCDCCC; font-weight: bold;">property</span>(<span style="color: #F0DFAF; font-weight: bold;">lambda</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>: <span style="color: #CC9393;">"Second"</span>) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">it is a descriptor</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.__class__.__dict__, bar.__dict__)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.foo) <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(Child.__dict__['foo'].__get__(bar, Child))</span>

<span style="color: #DFAF8F;">Child.__getattribute__</span> = getattribute1
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.__class__.__dict__, bar.__dict__)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.foo) 

<span style="color: #DFAF8F;">Child.__getattribute__</span> = getattribute2
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.__class__.__dict__, bar.__dict__)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(bar.foo)
</pre>
</div>
</div>

<div id="outline-container-sec-7-4-1" class="outline-4">
<h4 id="sec-7-4-1"><span class="section-number-4">7.4.1</span> <span class="underline"><span class="underline">slots</span></span></h4>
<div class="outline-text-4" id="text-7-4-1">
<p>
<code>__slots__</code> is class attribute, and <code>__dict__</code> is instance attribute.
</p>

<p>
Due to instance's <code>__dict__</code> attribute, you can add new attributes to an instance's namespace with any name you want. 
<code>__slots__</code> prevents the automatic creation of <code>__dict__</code> and <code>__weakref__</code>, and save memory, also it can limit set 
of attribute names that are allowed in instances of the class. 
</p>

<p>
If the base class uses <code>__slots__</code>, the subclass must declare a <code>__slots__</code>, even empty, or the memory saving will be lost.
If the base class has no <code>__slots__</code>, <code>__slots__</code> declared in subclass is meaningless because <code>__dict__</code> attribute of 
the base class is always accessible.
</p>

<p>
You can add <code>__dict__</code> into <code>__slots__</code>, and enable assignment of new attributes not listed in <code>__slots__</code>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Point</span>:
    <span style="color: #DFAF8F;">__slots__</span> = (<span style="color: #CC9393;">"x"</span>, <span style="color: #CC9393;">"y"</span>) 
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, x=0, y=0):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.x, <span style="color: #F0DFAF; font-weight: bold;">self</span>.y = x, y
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__str__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #CC9393;">".x: %d, .y: %d"</span>%(<span style="color: #F0DFAF; font-weight: bold;">self</span>.x, <span style="color: #F0DFAF; font-weight: bold;">self</span>.y)

<span style="color: #DFAF8F;">p</span> = Point(1,2)
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(p.__dict__) # it has no __dict__ attribute because of __slots__</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(p)
<span style="color: #DFAF8F;">p.y</span> = 4 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">you can change the value of attributes</span>
<span style="color: #F0DFAF; font-weight: bold;">del</span>(p.y); <span style="color: #DFAF8F;">p.y</span> = 7 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">you can remove the attribute declared in __slots__, and add it later</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(p)
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">p.z = 5 # you cannot add other attributes because of __slots__</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-4-2" class="outline-4">
<h4 id="sec-7-4-2"><span class="section-number-4">7.4.2</span> Descriptors</h4>
<div class="outline-text-4" id="text-7-4-2">
<p>
A descriptor is an object that is assigned as a class attribute(<i>celsius</i>) of a class(<i>Temperature</i>), and the 
object is an instance of a class(<i>Celsius</i>) that defines <code>__get__</code> method, and optionally <code>__set__</code> and <code>__delete__</code> 
methods, these methods are invoked automatically upon the attribute(<i>celsius</i>) access, that is, the 
attribute(<i>celsius</i>) access is overridden by methods <code>__get__</code>, <code>__set__</code> and <code>__delete__</code>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Celsius</span>:
    <span style="color: #CC9393;">'''</span>
<span style="color: #CC9393;">    the owner is class Temperature.</span>
<span style="color: #CC9393;">    the instance is None if the attribute(celsius) is accessed from the class(/Temperature/).</span>
<span style="color: #CC9393;">    its return value is given to the code that requests the value of the attribute.</span>
<span style="color: #CC9393;">    '''</span>
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, instance, owner):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> 5 * (instance.fahrenheit - 32) /9
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__set__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, instance, value): <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">it should not return anything</span>
        <span style="color: #DFAF8F;">instance.fahrenheit</span> =32 + 9 * value / 5

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Temperature</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, v):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fahrenheit = v
        <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">To add an instance attribute celsius, you should self.__dict__["celsius"] = 5 because self.celsius = 5 calls __set__ of Celsius</span>
    <span style="color: #DFAF8F;">celsius</span> = Celsius()

<span style="color: #DFAF8F;">t</span> = Temperature(212)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(t.celsius)
<span style="color: #DFAF8F;">t.celsius</span> = 0
<span style="color: #F0DFAF; font-weight: bold;">print</span>(t.fahrenheit)
</pre>
</div>

<p>
If an object defines both <code>__get__</code> and <code>__set__</code>, it is called a data descriptor. Descriptors only define <code>__get__</code> 
are called non-data descriptors.
</p>

<p>
Descriptors are mechanism behind properties, methods, static methods, class methods, and <code>super()</code>.
</p>
</div>
</div>

<div id="outline-container-sec-7-4-3" class="outline-4">
<h4 id="sec-7-4-3"><span class="section-number-4">7.4.3</span> property</h4>
<div class="outline-text-4" id="text-7-4-3">
<p>
The <code>property</code> class implements <code>__get__</code> and <code>__set__</code>, so it is a data descriptor. Its <code>__get__</code> is called in <code>__getattribute__</code>. 
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Circle</span>(Point):
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, radius, x=0, y=0):
        <span style="color: #DCDCCC; font-weight: bold;">super</span>().__init__(x, y)
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.__radius = radius

    <span style="color: #7CB8BB;">@property</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">property function takes radius function as getter argument, and returns a property instance</span>
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">radius</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__radius

    <span style="color: #7CB8BB;">@radius.setter</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">@radius returns an object of class property</span>
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">radius</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, radius):
        <span style="color: #F0DFAF; font-weight: bold;">assert</span> radius&gt;0, <span style="color: #CC9393;">"radius must be positive"</span>
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.__radius = radius

<span style="color: #DFAF8F;">c</span> = Circle(6, 3, 4)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(c.radius)
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">print(c.radius()) Error 'float' is not callable</span>
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">c.radius = 0 Error "radius must be positive"</span>
<span style="color: #DFAF8F;">c.radius</span> = 9
<span style="color: #F0DFAF; font-weight: bold;">print</span>(c.radius)
<span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">del c.radius Error: cannot delete attribute</span>
</pre>
</div>

<p>
To make an attribute(<i>radius</i>) into a readable(writable) property, it would be better to create a private attribute(<i>\<sub>radius</sub></i>), 
</p>

<p>
The <code>property()</code> function takes up to four arguments: a getter function, a setter function, a deleter function 
and a docstring, then returns an object of class <code>property</code>, which has methods <code>getter</code>, <code>setter</code> and <code>deleter</code> to 
change the getter function, setter function and deleter function respectively.
</p>

<p>
The <code>@property</code> is the same as calling the <code>property()</code> with just a argument, the getter function.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-5" class="outline-3">
<h3 id="sec-7-5"><span class="section-number-3">7.5</span> Context Manager</h3>
<div class="outline-text-3" id="text-7-5">
<p>
It allow us to simplify code by ensuring that certain operations are performed before and after a particular block is 
executed. It defines methods <code>__enter__()</code> and <code>__exit__()</code>. 
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">with</span> expression <span style="color: #F0DFAF; font-weight: bold;">as</span> variable: <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">the return value of __exit__ is assigned to variable</span>
  suit

<span style="color: #F0DFAF; font-weight: bold;">with</span> expression1 <span style="color: #F0DFAF; font-weight: bold;">as</span> variable1, expression2 <span style="color: #F0DFAF; font-weight: bold;">as</span> variable2: <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">only can be used since python3.1</span>
  suit
</pre>
</div>
<p>
The <code>__enter__()</code> is automatically called when it is created in a <code>with</code> statement, and its return value is used for 
the <i>as variable</i>.
</p>

<p>
The <code>__exit__(exc_type, exc_val, exc_tb)</code> is automatically called when it goes out of scope after <code>with</code> statement. The 
returning <code>True</code> will cause the <code>with</code> statement to suppress the exception, otherwise the exception continues propagate 
after <code>with</code> statement. The parameters are exception type, value and traceback infomation when an exception occurred while 
in the body of <code>with</code> statement, otherwise they are None.
</p>
</div>
</div>

<div id="outline-container-sec-7-6" class="outline-3">
<h3 id="sec-7-6"><span class="section-number-3">7.6</span> Class Decorator</h3>
<div class="outline-text-3" id="text-7-6">
<p>
Just as we can create decorators for functions and methods, we can also create decorators for entire classes.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">delegate</span>(attribute_name, method_names): 
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"delegate(%s,%s)"</span>%(attribute_name, method_names)) 
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">decorator</span>(cls):
        <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"decorate(%s)"</span>%cls.<span style="color: #DCDCCC; font-weight: bold;">__name__</span>)
        <span style="color: #F0DFAF; font-weight: bold;">nonlocal</span> attribute_name <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">without this statement, it raises UnboundLocalError: attribute_name referenced before assignment</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> attribute_name.startswith(<span style="color: #CC9393;">"__"</span>):
            <span style="color: #DFAF8F;">attribute_name</span> = <span style="color: #CC9393;">"_"</span>+cls.<span style="color: #DCDCCC; font-weight: bold;">__name__</span>+attribute_name
        <span style="color: #F0DFAF; font-weight: bold;">for</span> name <span style="color: #F0DFAF; font-weight: bold;">in</span> method_names:
            <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"%s.%s(self, *args, **kwargs)"</span>%(cls.<span style="color: #DCDCCC; font-weight: bold;">__name__</span>, name))
            <span style="color: #DCDCCC; font-weight: bold;">setattr</span>(cls, name, 
                    <span style="color: #DCDCCC; font-weight: bold;">eval</span>(<span style="color: #CC9393;">"lambda self, *args, **kwargs: self.{0}.{1}(*args, **kwargs)"</span>.<span style="color: #DCDCCC; font-weight: bold;">format</span>(attribute_name, name)))
        <span style="color: #F0DFAF; font-weight: bold;">return</span> cls
    <span style="color: #F0DFAF; font-weight: bold;">return</span> decorator

<span style="color: #7CB8BB;">@delegate</span>(<span style="color: #CC9393;">"__list"</span>, (<span style="color: #CC9393;">"pop"</span>, <span style="color: #CC9393;">"append"</span>, <span style="color: #CC9393;">"__getitem__"</span>, <span style="color: #CC9393;">"__delitem__"</span>, <span style="color: #CC9393;">"__iter__"</span>, <span style="color: #CC9393;">"__reversed__"</span>, <span style="color: #CC9393;">"__len__"</span>, <span style="color: #CC9393;">"__str__"</span>))
<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">SortedList</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.__list = []

<span style="color: #F0DFAF; font-weight: bold;">print</span>(SortedList.__dict__) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">delegate invoked when SortedList defined</span>
<span style="color: #DFAF8F;">s</span> = SortedList()
s.append(5)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #DCDCCC; font-weight: bold;">len</span>(s))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-7" class="outline-3">
<h3 id="sec-7-7"><span class="section-number-3">7.7</span> Abstract Base Class(ABC)</h3>
<div class="outline-text-3" id="text-7-7">
<p>
The purpose of it is to define interface, not to create instance. 
</p>

<p>
It has at least one abstract method or property. Abstract methods can be defined 
</p>
<ul class="org-ul">
<li>with no implementation(their suite is <code>pass</code>, or <code>raise NotImplementedError()</code>), or
</li>
<li>with an actual implementation that can be invoked from subclasses.
</li>
</ul>

<p>
Classes that derived from an ABC can be instantiated only if they reimplement al the 
abstract methods and abstract properties they have inherited.
</p>

<p>
All ABCs must have  ametaclass of <code>abc.ABCMeta</code> (from the <i>abc</i> module), or from one of its subclasses.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> abc

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Appliance</span>(metaclass=abc.ABCMeta): <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">for an ABC, abc.ABCMeta or its subclass is must</span>
    <span style="color: #7CB8BB;">@abc.abstractmethod</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">to make __init__() an abstract method</span>
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, model, price):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.__module = model
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.price = price <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">set_price() will be called to initiate private data (__price) directly</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">get_price</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__price

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">set_price</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, price):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.__price = price

    <span style="color: #DFAF8F;">price</span> = abc.abstractproperty(get_price, set_price) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">to make an abstact readable/writable property</span>

    <span style="color: #7CB8BB;">@property</span> 
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">model</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>): <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">the model property is not abstract, no need reimplementing it in concrete subclass although it is allowed</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__module

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Cooker</span>(Appliance):
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, model, price, fuel):
        <span style="color: #DCDCCC; font-weight: bold;">super</span>().__init__(model, price)
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fuel = fuel

    <span style="color: #DFAF8F;">price</span> = <span style="color: #DCDCCC; font-weight: bold;">property</span>(<span style="color: #F0DFAF; font-weight: bold;">lambda</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>: <span style="color: #DCDCCC; font-weight: bold;">super</span>().price, <span style="color: #F0DFAF; font-weight: bold;">lambda</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>, price: <span style="color: #DCDCCC; font-weight: bold;">super</span>().set_price(price))

<span style="color: #DFAF8F;">cooker</span> = Cooker(<span style="color: #CC9393;">"module"</span>, 1.2, <span style="color: #CC9393;">"oil"</span>)
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"model: %s, price: %f, fuel: %s"</span>%(cooker.model, cooker.price, cooker.fuel))
<span style="color: #DFAF8F;">cooker.price</span> = 2.4
<span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #CC9393;">"model: %s, price: %f, fuel: %s"</span>%(cooker.model, cooker.price, cooker.fuel))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7-8" class="outline-3">
<h3 id="sec-7-8"><span class="section-number-3">7.8</span> Multiple Inheritance</h3>
<div class="outline-text-3" id="text-7-8">
<p>
Multiple inheritance can generally be avoided by using single inheritance and setting a metaclass if we want to 
support an additional API.
</p>
</div>
</div>
<div id="outline-container-sec-7-9" class="outline-3">
<h3 id="sec-7-9"><span class="section-number-3">7.9</span> Metaclasses</h3>
<div class="outline-text-3" id="text-7-9">
<p>
Classes are objects, so you can
</p>
<ul class="org-ul">
<li>assign it to a variable
</li>
<li>copy it
</li>
<li>add attributes to it
</li>
<li>pass it as a function parameter
</li>
<li>be created dynamically (even in a function)
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">make_class</span>(class_name):
  <span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">C</span>:
      <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">print_class_name</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>):
          <span style="color: #F0DFAF; font-weight: bold;">print</span>(class_name)
  C.<span style="color: #DCDCCC; font-weight: bold;">__name__</span> = class_name
  <span style="color: #F0DFAF; font-weight: bold;">return</span> C

<span style="color: #DFAF8F;">C1</span>, <span style="color: #DFAF8F;">C2</span> = [make_class(c) <span style="color: #F0DFAF; font-weight: bold;">for</span> c <span style="color: #F0DFAF; font-weight: bold;">in</span> (<span style="color: #CC9393;">"C1"</span>, <span style="color: #CC9393;">"C2"</span>)]
<span style="color: #DFAF8F;">c1</span>, <span style="color: #DFAF8F;">c2</span> = C1(), C2()
c1.print_class_name()
</pre>
</div>
</li>
</ul>

<p>
Python creates a new class by calling a metaclass explicitly. Example shown below. The class <code>type</code> is a metaclass, 
and all metaclasses must inherit from it or its subclass.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">greet</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, who):
    <span style="color: #F0DFAF; font-weight: bold;">print</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>.greeting, who)

<span style="color: #DFAF8F;">Person</span> = <span style="color: #DCDCCC; font-weight: bold;">type</span>(<span style="color: #CC9393;">'Person'</span>, (<span style="color: #DCDCCC; font-weight: bold;">object</span>,), {<span style="color: #CC9393;">'greet'</span>: greet, <span style="color: #CC9393;">'greeting'</span>: <span style="color: #CC9393;">'Hello'</span>}) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">type(classname, baseclasses, attributes)</span>

<span style="color: #DFAF8F;">jonathan</span> = Person()
jonathan.greet(<span style="color: #CC9393;">'Readers'</span>) <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">output: Hello Readers</span>
</pre>
</div>
<p>
Also the metaclass can be called implicitly before a class-to-be created, and the metaclass is determined by looking at 
the baseclasses of the class-to-be(metaclasses are inherited), at the <code>__metaclass__</code> attribute of the class-to-be or the 
<code>__metaclass__</code> global variable. 
</p>

<p>
All metaclasses must inherit from it or its subclass, why?
</p>
<ul class="org-ul">
<li><code>type(object)</code> is <code>type</code>
</li>
<li>class <code>object</code> is ultimate base class
</li>
<li>metaclass of a class-to-be must be subclass of the metaclass of its base class 
</li>
</ul>

<p>
If the metaclass of a class-to-be is determined by its baseclass(instead of <code>__metaclass__</code> attribute), then methods 
defined on the metaclass become class methods of the class-to-be, and can be invoked by the class-to-be, but not the 
instance of the class-to-be, that is different from normal class methods, which can be called from either a class or its instancess.
</p>

<p>
It an be used to change the classes that use them. If the change involves the name, base classes, or directory of 
the class beging created(e.g., <code>__slots__</code>), then we need to reimplement the metaclass's <code>__new__()</code>; but for other 
changes, such as adding methods or data attributes, reimplementing <code>__init__()</code> is sufficient.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Field</span>(<span style="color: #DCDCCC; font-weight: bold;">object</span>):
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, ftype):
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.ftype = ftype

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">is_valid</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, value):
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #DCDCCC; font-weight: bold;">isinstance</span>(value, <span style="color: #F0DFAF; font-weight: bold;">self</span>.ftype)

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">EnforcerMeta</span>(<span style="color: #DCDCCC; font-weight: bold;">type</span>):
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span>(cls, name, bases, ns):
        <span style="color: #DFAF8F;">cls._fields</span> = {}
        <span style="color: #F0DFAF; font-weight: bold;">for</span> key, value <span style="color: #F0DFAF; font-weight: bold;">in</span> ns.items():
            <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #DCDCCC; font-weight: bold;">isinstance</span>(value, Field):
                <span style="color: #DFAF8F;">cls._fields</span>[key] = value

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Enforcer</span>(metaclass=EnforcerMeta):   
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__setattr__</span>(<span style="color: #F0DFAF; font-weight: bold;">self</span>, key, value):
        <span style="color: #F0DFAF; font-weight: bold;">if</span> key <span style="color: #F0DFAF; font-weight: bold;">in</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>._fields:
            <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">not</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>._fields[key].is_valid(value):
                <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">TypeError</span>(<span style="color: #CC9393;">'Invalid type for field'</span>)
            <span style="color: #DCDCCC; font-weight: bold;">super</span>().__setattr__(key, value)

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Person</span>(Enforcer):
    <span style="color: #DFAF8F;">name</span> = Field(<span style="color: #DCDCCC; font-weight: bold;">str</span>)
    <span style="color: #DFAF8F;">age</span> = Field(<span style="color: #DCDCCC; font-weight: bold;">int</span>)

<span style="color: #DFAF8F;">p</span> = Person()
<span style="color: #DFAF8F;">p.name</span> = <span style="color: #CC9393;">"Howard"</span>
<span style="color: #DFAF8F;">p.age</span> = 30
<span style="color: #DFAF8F;">p.name</span> = <span style="color: #CC9393;">"Hou"</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(p.name, p.age)
<span style="color: #DFAF8F;">Person.name</span>=<span style="color: #CC9393;">"123"</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(p.name, p.age)
</pre>
</div>

<p>
Class decorators and metaclasses have quite a bit in common. In fact, anything that can be done with a class decorator 
can done using a metaclass. Metaclasses are capable of more since they are run before the class is created, rather than 
after, which is the case with decorators. 
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

                          <div id="disqus_thread"></div>
                          <script type="text/javascript">
                            var disqus_shortname = 'howardhou';
                            (function() {
                              var dsq = document.createElement('script'); 
                              dsq.type = 'text/javascript'; 
                              dsq.async = true;
                              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                            })();
                          </script>
                          <script>
                            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
                            ga('create', 'UA-38087210-2', 'auto');
                            ga('send', 'pageview');
                          </script>
                          <p class="postamble">Last Updated 2015-11-14 Sat 20:55. </p>
                          <p class="postamble">Created by Howard Hou with <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
</div>
</body>
</html>
